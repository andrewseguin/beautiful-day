<div *ngFor="let queryStage of queryStages; let queryStageIndex = index; let lastQueryStage = last; trackBy:trackByIndex"
     class="query-stage-container">
  <div [class.has-following-query-stage]="!lastQueryStage && queryStages.length > 1"
       class="query-stage mat-elevation-z1">
    <div *ngFor="let query of queryStage.querySet; let querySetIndex = index; let lastQuerySet = last; trackBy:trackByIndex">
      <div class="query-input-container">
        <mat-form-field [floatLabel]="'never'">
          <input matInput placeholder="Enter query"
                 (ngModelChange)="queryStage.querySet[querySetIndex].queryString = $event; inputChange.next()"
                 [(ngModel)]="queryStage.querySet[querySetIndex].queryString">
        </mat-form-field>
        <button mat-icon-button
                [disabled]="queryStages.length === 1 && queryStage.querySet.length === 1"
                (click)="removeQuery(queryStageIndex, queryStage.querySet, querySetIndex)">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div *ngIf="!lastQuerySet && queryStage.querySet.length > 1"
           class="or-label">
        OR
      </div>
    </div>
    <button mat-button class="add-or"
            (click)="queryStage.querySet.push({queryString: '', type: 'any'})">
      + OR
    </button>
  </div>
  <div *ngIf="!lastQueryStage && queryStages.length > 1"
       class="and-label">
    AND
  </div>
</div>

<button mat-button class="add-and"
        (click)="queryStages.push({querySet: [{queryString: '', type: 'any'}]})">
  + AND
</button>
