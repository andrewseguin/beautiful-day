<div class="request" md-ripple
     (click)="setSelected(!isSelected())"
     [@highlightTrigger]="highlightState"
     [@displayTrigger]="displayState">
  <div *ngIf="displayState == 'visible'"
       [style.z-index]="1"> <!-- Be above the mdripple -->
    <div class="top-row">
      <md-checkbox [style.visibility]="canEdit ? 'visible' : 'hidden'"
                   [checked]="isSelected()"
                   (click)="$event.stopPropagation()"
                   (change)="setSelected($event.checked)">
      </md-checkbox>

      <div class="name">
        <span class="editable clickable" (click)="viewItem($event)">{{item.name}}</span>
      </div>

      <div class="quantity" (click)="$event.stopPropagation()">
        <input type="number" #quantityInput min="0"
               *ngIf="canEdit && !isReporting"
               [value]="request?.quantity"
               (keyup)="changeQuantity($event.target.value)"
               (keydown.Enter)="quantityInput.blur()"
               (change)="changeQuantity($event.target.value)">
        <div *ngIf="!canEdit || isReporting">x {{request?.quantity}}</div>
      </div>

      <div class="cost" *ngIf="requestViewOptions.cost">
        <span *ngIf="item.cost">
          {{item.cost*request?.quantity | currency:'USD':true:'1.2-2'}}
        </span>
        <span *ngIf="!item.cost">--</span>
      </div>
    </div>

    <div class="details">
      <div *ngIf="isReporting">
        <span class="editable">
          Project: {{projectName}}
        </span>
      </div>

      <div *ngIf="requestViewOptions.dropoff">
        <span class="editable"
              [class.clickable]="canEdit && !isReporting"
              (click)="editDropoff($event)">
          <span *ngIf="request?.dropoff">
            Receive @ {{request?.dropoff}}, {{request?.date | date}}
          </span>
        </span>
      </div>
      <div *ngIf="request?.note && requestViewOptions.notes">
        <span class="editable"
              [class.clickable]="canEdit && !isReporting"
              (click)="editNote($event)">
          {{request?.note}}
        </span>
      </div>
      <div *ngIf="request?.tags && requestViewOptions.tags" class="tags">
        <span class="editable clickable tag" *ngFor="let tag of request.tags.split(',').sort()"
              [style.background]="getTagColor(tag)"
              (click)="$event.stopPropagation(); filterTag.emit(tag)">
          {{tag}}
        </span>
      </div>
    </div>
  </div>
</div>
